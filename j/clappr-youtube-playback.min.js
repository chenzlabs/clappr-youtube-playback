!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],e):"object"==typeof exports?exports.YoutubePlayback=e(require("Clappr")):t.YoutubePlayback=e(t.Clappr)}(this,function(t){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="<%=baseUrl%>/",e(0)}([function(t,e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),s=function(t,e,i){for(var r=!0;r;){var n=t,a=e,o=i;r=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var l=Object.getPrototypeOf(n);if(null===l)return;t=l,e=a,i=o,r=!0,s=l=void 0}},u=i(1),l=i(2),p=r(l),y=i(4),h=r(y),c=/^.*((youtu.be\/)|(youtube.com\/v\/)|(youtube.com\/u\/\w\/)|(youtube.com\/embed\/)|(youtube.com\/watch\?)|(feature\=player_embedded&))\??v?=?([^#\&\?]*).*/,d=!1,f=function(t){function e(t){if(n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.settings={changeCount:0,seekEnabled:!0,left:["playpause","position","duration"],default:["seekbar"],right:["fullscreen","volume","hd-indicator"]},u.Mediator.on(u.Events.PLAYER_RESIZE,this.updateSize,this),d){var i=this;setTimeout(function(){i.ready()},500)}else this.embedYoutubeApiScript(),d=!0}return a(e,t),o(e,[{key:"name",get:function(){return"youtube_playback"}},{key:"template",get:function(){return(0,u.template)(h.default)}},{key:"attributes",get:function(){return{"data-youtube-playback":"",class:"clappr-youtube-playback",id:this.cid}}},{key:"ended",get:function(){return!1}},{key:"buffering",get:function(){return this.player&&this.player.getPlayerState()===YT.PlayerState.BUFFERING}},{key:"isReady",get:function(){return this._ready}}]),o(e,[{key:"setupYoutubePlayer",value:function(){var t=this;window.YT&&window.YT.Player?this.embedYoutubePlayer():(console.log("awaiting PLAYBACK_READY"),this.once(u.Events.PLAYBACK_READY,function(){return t.embedYoutubePlayer()}))}},{key:"embedYoutubeApiScript",value:function(){var t=this,e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("async","async"),e.setAttribute("src","https://www.youtube.com/iframe_api"),document.body.appendChild(e),window.onYouTubeIframeAPIReady=function(){return t.ready()}}},{key:"findVideoId",value:function(t){var e=t.match(c);return e&&11===e[e.length-1].length?e[e.length-1]:t}},{key:"findVideoQuality",value:function(t){var e=/[?&]vq=([^#\&\?]+)/,i=t.match(e);return null!==i&&i.length>1?i[1]:"auto"}},{key:"embedYoutubePlayer",value:function(){var t=this,e={controls:0,autoplay:1,disablekb:1,enablejsapi:1,iv_load_policy:3,modestbranding:1,showinfo:0,html5:1,playsinline:1,vq:this.options.videoQuality||this.findVideoQuality(this.options.src),rel:this.options.youtubeShowRelated||0,loop:this.options.loop?1:0},i="file:"===window.location.protocol||"app:"===window.location.protocol;i||(e.origin=window.location.protocol+"//"+window.location.host),this.options.youtubePlaylist&&(e.listType="playlist",e.list=this.options.youtubePlaylist),this.player=new YT.Player("yt"+this.cid,{width:this.options.width||"100%",height:this.options.height||"100%",videoId:this.findVideoId(this.options.src),playerVars:e,events:{onReady:function(){return t.ready()},onStateChange:function(e){return t.stateChange(e)},onPlaybackQualityChange:function(e){return t.qualityChange(e)}}})}},{key:"updateSize",value:function(){this.player&&this.player.setSize(this.$el.width(),this.$el.height())}},{key:"ready",value:function(){this._ready=!0,this.options.mute&&this.volume(0),console.log("trigger PLAYBACK_READY"),this.trigger(u.Events.PLAYBACK_READY)}},{key:"qualityChange",value:function(t){this.trigger(u.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.isHighDefinitionInUse())}},{key:"stateChange",value:function(t){switch(t.data){case YT.PlayerState.PLAYING:this.enableMediaControl();var e=this.getPlaybackType();this._playbackType!==e&&(this.settings.changeCount++,this._playbackType=e,this.trigger(u.Events.PLAYBACK_SETTINGSUPDATE)),this.trigger(u.Events.PLAYBACK_BUFFERFULL),this.trigger(u.Events.PLAYBACK_PLAY);break;case YT.PlayerState.PAUSED:this.trigger(u.Events.PLAYBACK_PAUSE);break;case YT.PlayerState.BUFFERING:this.trigger(u.Events.PLAYBACK_BUFFERING);break;case YT.PlayerState.ENDED:this.options.youtubeShowRelated?this.disableMediaControl():this.trigger(u.Events.PLAYBACK_ENDED)}}},{key:"play",value:function(){var t=this;this.player?(this._progressTimer=this._progressTimer||setInterval(function(){return t.progress()},100),this._timeupdateTimer=this._timeupdateTimer||setInterval(function(){return t.timeupdate()},100),this.player.playVideo()):this._ready?(this.trigger(u.Events.PLAYBACK_BUFFERING),this._progressTimer=this._progressTimer||setInterval(function(){return t.progress()},100),this._timeupdateTimer=this._timeupdateTimer||setInterval(function(){return t.timeupdate()},100),this.setupYoutubePlayer()):(this.trigger(u.Events.PLAYBACK_BUFFERING),this.listenToOnce(this,u.Events.PLAYBACK_READY,this.play))}},{key:"pause",value:function(){clearInterval(this._timeupdateTimer),this._timeupdateTimer=null,this.player&&this.player.pauseVideo()}},{key:"seek",value:function(t){this.player&&this.player.seekTo(t)}},{key:"seekPercentage",value:function(t){if(this.player){var e=this.player.getDuration(),i=t*e/100;this.seekTo(i)}}},{key:"volume",value:function(t){this.player&&this.player.setVolume&&this.player.setVolume(t)}},{key:"progress",value:function(){if(this.player&&this.player.getDuration){var t=this.player.getDuration()*this.player.getVideoLoadedFraction();this.trigger(u.Events.PLAYBACK_PROGRESS,{start:0,current:t,total:this.player.getDuration()})}}},{key:"timeupdate",value:function(){this.player&&this.player.getDuration&&this.trigger(u.Events.PLAYBACK_TIMEUPDATE,{current:this.player.getCurrentTime(),total:this.player.getDuration()})}},{key:"isPlaying",value:function(){return this.player&&this.player.getPlayerState()==YT.PlayerState.PLAYING}},{key:"isHighDefinitionInUse",value:function(){return this.player&&!!this.player.getPlaybackQuality().match(/^hd\d+/)}},{key:"getDuration",value:function(){var t=0;return this.player&&(t=this.player.getDuration()),t}},{key:"getPlaybackType",value:function(){return u.Playback.VOD}},{key:"disableMediaControl",value:function(){this.$el.css({"pointer-events":"auto"}),this.trigger(u.Events.PLAYBACK_MEDIACONTROL_DISABLE)}},{key:"enableMediaControl",value:function(){this.$el.css({"pointer-events":"none"}),this.trigger(u.Events.PLAYBACK_MEDIACONTROL_ENABLE)}},{key:"render",value:function(){this.$el.html(this.template({id:"yt"+this.cid}));var t=u.Styler.getStyleFor(p.default,{baseUrl:this.options.baseUrl});return this.$el.append(t),this.options.autoPlay&&this.play(),this}}]),e}(u.Playback);e.default=f,f.canPlay=function(t){return c.test(t)},t.exports=e.default},function(e,i){e.exports=t},function(t,e,i){e=t.exports=i(3)(),e.push([t.id,".clappr-youtube-playback[data-youtube-playback]{position:absolute;height:100%;width:100%;display:block;pointer-events:none}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var i=this[e];i[2]?t.push("@media "+i[2]+"{"+i[1]+"}"):t.push(i[1])}return t.join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},n=0;n<this.length;n++){var a=this[n][0];"number"==typeof a&&(r[a]=!0)}for(n=0;n<e.length;n++){var o=e[n];"number"==typeof o[0]&&r[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="("+o[2]+") and ("+i+")"),t.push(o))}},t}},function(t,e){t.exports='<div id="<%=id%>"></div>'}])});
//# sourceMappingURL=clappr-youtube-playback.min.js.map